<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Encuesta de Clima Laboral</title>

<style>
:root{
  --bg:#f3f6fb;
  --card:#ffffff;
  --text:#1f2937;
  --muted:#6b7280;
  --line:#e5e7eb;
  --primary:#2f5ea6;
  --secondary:#4f7fd1;
  --soft:#eef4ff;
  --danger:#dc2626;
  --radius:18px;
  --shadow:0 20px 45px rgba(0,0,0,.10);
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
  background:
    radial-gradient(1200px 520px at 10% -10%, rgba(47,94,166,.16), transparent 55%),
    radial-gradient(1000px 520px at 90% 10%, rgba(79,127,209,.14), transparent 60%),
    var(--bg);
  color:var(--text);
}

.container{
  max-width:1200px;
  margin:auto;
  padding:20px 16px 40px;
}

/* HEADER */
.header{
  text-align:center;
  margin-bottom:20px;
  padding:0 10px;
}
.header img{
  height:60px;
  margin-bottom:12px;
  filter: drop-shadow(0 10px 18px rgba(0,0,0,.10));
}
.header h1{
  margin:0;
  font-size:24px;
  color:#355f9e;
  line-height:1.3;
}
.header h2{
  margin:6px 0 0;
  font-weight:500;
  font-size:15px;
  color:#6b8fc7;
}

/* CARD */
.card{
  background:var(--card);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  padding:20px 18px 28px;
}

/* PROGRESS */
.progress{
  height:8px;
  background:#e6ecf5;
  border-radius:999px;
  overflow:hidden;
  margin-bottom:20px;
}
.progress span{
  display:block;
  height:100%;
  width:0%;
  background:linear-gradient(90deg,var(--primary),var(--secondary));
  transition:.35s ease;
}

/* STEP TITLE ROW */
.toprow{
  display:flex;
  flex-direction:column;
  gap:12px;
  align-items:flex-start;
  margin-bottom:16px;
}
.stepchip{
  display:inline-flex;
  gap:8px;
  align-items:center;
  border:1px solid var(--line);
  padding:8px 12px;
  border-radius:999px;
  background:#fbfdff;
  color:var(--muted);
  font-size:12px;
  max-width:100%;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
#hintChip{
  font-size:11px;
  white-space:normal;
  line-height:1.4;
  max-width:100%;
}

/* SECTION */
.section{display:none}
.section.active{display:block}

.section h3{
  margin:0 0 16px;
  font-size:20px;
  color:#334155;
  border-left:5px solid var(--primary);
  padding-left:12px;
  line-height:1.4;
}

/* NOTICE */
.notice{
  max-width:100%;
  background:#eef4ff;
  border-left:4px solid #2f5ea6;
  padding:12px 14px;
  border-radius:10px;
  font-size:13px;
  color:#334155;
  line-height:1.4;
  box-shadow:0 6px 16px rgba(47,94,166,.08);
  margin-bottom:16px;
}

/* INPUTS */
.input-grid{
  display:grid;
  grid-template-columns: 1fr;
  gap:16px;
}
@media(min-width:640px){ 
  .input-grid{
    grid-template-columns: 1fr 1fr;
  }
}

.input-group{margin-bottom:16px}
.input-group label{
  display:block;
  font-weight:650;
  margin-bottom:6px;
  color:#334155;
  font-size:14px;
}
.input-group input,
.input-group textarea,
.input-group select{
  width:100%;
  padding:14px 16px;
  border-radius:14px;
  border:1px solid var(--line);
  font-size:16px; /* Aumentado para m√≥viles */
  outline:none;
  background:#fff;
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
}
.input-group input:focus,
.input-group textarea:focus,
.input-group select:focus{
  border-color: rgba(47,94,166,.65);
  box-shadow: 0 0 0 3px rgba(47,94,166,.12);
}
textarea{
  min-height:140px;
  font-family: inherit;
}

/* SELECT STYLING */
.select-wrapper{
  position:relative;
}
.select-wrapper::after{
  content:"‚ñº";
  position:absolute;
  right:16px;
  top:50%;
  transform:translateY(-50%);
  color:var(--muted);
  font-size:12px;
  pointer-events:none;
}

/* QUESTIONS */
.q{
  display:flex;
  flex-direction:column;
  gap:16px;
  padding:16px;
  border-radius:14px;
  border:1px dashed var(--line);
  margin-bottom:16px;
  background:#fff;
}
.q.error{
  border-color: var(--danger);
  background: #fff5f5;
}
.q .qtext{
  font-size:15px;
  line-height:1.5;
}
.q .qtext small{
  display:block;
  margin-top:6px;
  color:var(--muted);
  font-size:12px;
}

/* SCALE */
.scale{
  display:grid;
  grid-template-columns:repeat(2, 1fr);
  gap:8px;
}
@media(min-width:480px){
  .scale{
    grid-template-columns:repeat(5, 1fr);
  }
}
.scale label{
  border:1px solid var(--line);
  border-radius:12px;
  padding:12px 4px;
  text-align:center;
  font-size:12px;
  cursor:pointer;
  background:#fff;
  transition:.15s ease;
  user-select:none;
  line-height:1.3;
  min-height:52px;
  display:flex;
  align-items:center;
  justify-content:center;
}
.scale label:hover{border-color:var(--primary)}
.scale input{display:none}
.scale label.selected{
  background:var(--soft);
  border-color:var(--primary);
  box-shadow:0 0 0 3px rgba(47,94,166,.12);
}

/* OPTIONAL BLOCK */
.optionalNote{
  margin:-6px 0 14px;
  color:var(--muted);
  font-size:13px;
  line-height:1.4;
}

/* NAV */
.nav{
  display:flex;
  justify-content:space-between;
  margin-top:24px;
  gap:10px;
}
button{
  padding:16px 24px;
  border-radius:999px;
  border:none;
  cursor:pointer;
  font-weight:700;
  font-size:15px;
  flex:1;
  min-height:52px;
  display:flex;
  align-items:center;
  justify-content:center;
  touch-action: manipulation; /* Mejora t√°ctil */
}
.btn-prev{
  background:#eef2f7;
  color:#334155;
}
.btn-next{
  background:linear-gradient(135deg,var(--primary),var(--secondary));
  color:#fff;
}
.btn-prev:disabled{opacity:.6; cursor:not-allowed}
.btn-next:disabled{opacity:.7; cursor:not-allowed}

/* MINI STATUS */
.status{
  margin-top:14px;
  font-size:13px;
  color:var(--muted);
  display:none;
  text-align:center;
}
.status.show{display:block}

/* HIDDEN FIELD */
.hidden-field{
  display:none !important;
}

/* MOBILE SPECIFIC */
@media(max-width:480px){
  .container{
    padding:16px 12px 30px;
  }
  .card{
    padding:18px 14px 24px;
    border-radius:16px;
  }
  .header h1{
    font-size:22px;
  }
  .header h2{
    font-size:14px;
  }
  .section h3{
    font-size:18px;
  }
  .q .qtext{
    font-size:14px;
  }
  .input-group input,
  .input-group textarea,
  .input-group select{
    font-size:16px;
    padding:12px 14px;
  }
  button{
    padding:14px 20px;
    font-size:14px;
  }
  .scale label{
    font-size:11px;
    padding:10px 4px;
    min-height:48px;
  }
}

/* TABLET */
@media(min-width:641px) and (max-width:1024px){
  .container{
    padding:24px 20px 50px;
  }
  .scale label{
    font-size:11px;
  }
}

/* ANIMATIONS */
@keyframes fadeIn{
  from{opacity:0; transform:translateY(10px);}
  to{opacity:1; transform:translateY(0);}
}
.section.active{
  animation:fadeIn 0.3s ease;
}

/* SCROLLBAR */
::-webkit-scrollbar{
  width:6px;
}
::-webkit-scrollbar-track{
  background:#f1f1f1;
}
::-webkit-scrollbar-thumb{
  background:#c1c1c1;
  border-radius:10px;
}
</style>
</head>

<body>
<div class="container">
  <div class="header">
    <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTj-tq3BshHFf6bNvxrroJukZptp60Xd79mTA&s" alt="Logo">
    <h1>Encuesta de Clima Laboral</h1>
    <h2>Ambiente Organizacional</h2>
  </div>

  <div class="card">
    <div class="progress"><span id="bar"></span></div>

    <div class="toprow">
      <div class="stepchip" id="stepChip">Secci√≥n 1 de 1</div>
      <div class="stepchip" id="hintChip">Escala: Nunca ¬∑ Casi nunca ¬∑ A veces ¬∑ Casi siempre ¬∑ Siempre</div>
    </div>

    <form id="form" novalidate>
      <div id="sections"></div>

      <div class="nav">
        <button type="button" class="btn-prev" id="prev">Anterior</button>
        <button type="button" class="btn-next" id="next">Siguiente</button>
      </div>

      <div class="status" id="status"></div>
    </form>
  </div>
</div>

<script>
(() => {
  // ‚úÖ WEBHOOK PABBLY
  const WEBHOOK_URL = "https://connect.pabbly.com/workflow/sendwebhookdata/IjU3NjcwNTZkMDYzMzA0MzE1MjY1NTUzMzUxMzQi_pc";

  const ORG_NAME = "[Nombre de la Organizaci√≥n]"; // cambia esto si quieres
  const LIKERT = ["Nunca","Casi nunca","A veces","Casi siempre","Siempre"];
  
  // Lista de cargos disponibles
  const CARGOS = [
  "ADMINISTRATIVO",
  "CONDUCTOR",
  "GESTOR DE MOVILIDAD",
  "GESTOR DE SERVICIO",
  "OPERATIVO"
];


  

  // ‚úÖ TODAS LAS SECCIONES + TODAS LAS PREGUNTAS
  const SECTIONS = [
    { id: "participant", title: "Datos del Participante", type: "participant" },
    {
      id: "colaboracion",
      title: "Colaboraci√≥n",
      questions: [
        "Cuento con la colaboraci√≥n de mis compa√±eros de departamento",
        "Cuento con la colaboraci√≥n de las personas de otros departamentos",
        "Cuando ingres√© en la Compa√±√≠a me sent√≠ bienvenido",
        "Considero que existe un buen ambiente de trabajo"
      ]
    },
    {
      id: "comunicacion",
      title: "Comunicaci√≥n",
      questions: [
        "Cuando ingres√© en la Compa√±√≠a recib√≠ suficiente informaci√≥n sobre la misma",
        "Al unirme a la Compa√±√≠a, recib√≠ suficiente informaci√≥n sobre el √°rea donde trabajo y la funci√≥n que realizo",
        "Los comunicados internos me proporcionan informaci√≥n √∫til",
        `Tengo disponible informaci√≥n sobre el cat√°logo de productos y servicios que ofrece ${ORG_NAME}`,
        `Tengo disponible informaci√≥n sobre la organizaci√≥n y la evoluci√≥n de ${ORG_NAME} a nivel mundial`,
        `La comunicaci√≥n interna en ${ORG_NAME} es una actividad permanente y planificada`,
        "La revista o publicaci√≥n interna para el empleado me proporciona informaci√≥n √∫til",
        `Conozco el C√≥digo √âtico y de Conducta de ${ORG_NAME}`,
        "La comunicaci√≥n sobre los resultados y marcha de la Compa√±√≠a es clara y transparente"
      ]
    },
    {
      id: "condiciones",
      title: "Condiciones de Trabajo",
      questions: [
        `${ORG_NAME} cumple las normas de Seguridad y Salud en el trabajo de manera diferencial`,
        "Dispongo de los materiales y recursos necesarios para realizar mi trabajo",
        "Las condiciones de espacio, ruido, temperatura, iluminaci√≥n‚Ä¶ me permiten desempe√±ar mi trabajo con normalidad"
      ]
    },
    {
      id: "formacion",
      title: "Formaci√≥n",
      questions: [
        "Recibo formaci√≥n para actualizar los conocimientos de mi trabajo",
        `Los planes de formaci√≥n de ${ORG_NAME} se adecuan a mis necesidades de desarrollo profesional en la Compa√±√≠a`
      ]
    },
    {
      id: "liderazgo",
      title: "Liderazgo",
      questions: [
        `Mi responsable se preocupa por transmitir los valores, misi√≥n y objetivos de ${ORG_NAME}`,
        "Mi responsable me proporciona peri√≥dicamente informaci√≥n sobre mi desempe√±o",
        "Mi responsable es claro y espec√≠fico cuando define mis objetivos de trabajo o los del departamento",
        "Mi responsable escucha mis opiniones y me hace part√≠cipe de las decisiones",
        "Mi responsable me felicita cuando realizo bien mi trabajo",
        "Mi responsable se preocupa por mantener un buen clima en el equipo",
        "Mi responsable se preocupa por conocer mis necesidades e intereses",
        "Mi responsable me trata justamente y evita cualquier tipo de favoritismos",
        "Mantengo una buena relaci√≥n con mi responsable",
        "Mi responsable respeta las diferencias de cultura, sexo, religi√≥n‚Ä¶",
        "Puedo tomar decisiones propias sin necesidad de consultar con mi jefe",
        "Mi responsable es un referente en la Compa√±√≠a",
        "Mi responsable hace un seguimiento de mi Plan de Desarrollo Individual"
      ]
    },
    {
      id: "cliente",
      title: "Orientaci√≥n al Cliente",
      questions: [
        `Los procesos y procedimientos de trabajo en ${ORG_NAME} me orientan hacia el cliente interno/externo`,
        "Estoy dispuesto a realizar un esfuerzo extra para satisfacer a mi cliente interno o externo",
        `He hablado a familiares y amigos sobre las ventajas de contratar servicios de ${ORG_NAME}`
      ]
    },
    {
      id: "servicios",
      title: "Percepci√≥n de los Servicios Centrales",
      questions: [
        `Recibo la ayuda que necesito del departamento de RRHH en ${ORG_NAME}`,
        "Recibo la ayuda que necesito del departamento Comercial / Marketing",
        "Recibo la ayuda que necesito del departamento Financiero",
        "Recibo la ayuda que necesito del departamento de Compras",
        "Recibo la ayuda que necesito del departamento de Inform√°tica",
        "Recibo la ayuda que necesito del departamento Jur√≠dico"
      ]
    },
    {
      id: "satisfaccion",
      title: "Satisfacci√≥n en el Puesto de Trabajo",
      questions: [
        "Tengo claro cu√°les son mis tareas y responsabilidades",
        "Conozco c√≥mo mi trabajo contribuye a conseguir los resultados de mi departamento",
        "Mi capacidad profesional est√° de acuerdo a las tareas y responsabilidades asignadas",
        "Mi trabajo me ofrece retos y la oportunidad de seguir mejorando",
        "Tengo la oportunidad de proponer nuevos proyectos o nuevas formas de realizar el trabajo",
        "Mi trabajo es reconocido y valorado",
        `${ORG_NAME} me da/ofrece la oportunidad de trabajar en proyectos/actividades que suponen nuevos retos`,
        "Tengo la informaci√≥n que necesito para realizar mi trabajo con excelencia"
      ]
    },
    { id: "sociodemo", title: "Datos sociodemogr√°ficos (Opcional)", type: "sociodemo" },
    { id: "observaciones", title: "Observaciones Finales", type: "observaciones" }
  ];

  const $ = (s, el=document) => el.querySelector(s);
  const $$ = (s, el=document) => Array.from(el.querySelectorAll(s));

  const sectionsWrap = $("#sections");
  const statusEl = $("#status");

  function setStatus(msg){
    statusEl.textContent = msg;
    statusEl.classList.add("show");
  }
  function clearStatus(){
    statusEl.textContent = "";
    statusEl.classList.remove("show");
  }

  // ---- render helpers
  const renderScale = (name) => {
    return `
      <div class="scale" data-name="${name}">
        ${LIKERT.map((t, i) => `
          <label>
            <input type="radio" name="${name}" value="${i+1}">
            ${t}
          </label>
        `).join("")}
      </div>
    `;
  };

  const esc = (str) => String(str).replace(/[&<>"']/g, m => ({
    "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
  }[m]));

  // ---- build DOM
  let qCounter = 0;

  SECTIONS.forEach((sec, idx) => {
    const sectionEl = document.createElement("section");
    sectionEl.className = "section" + (idx === 0 ? " active" : "");
    sectionEl.dataset.sectionId = sec.id;

    if (sec.type === "participant") {
      sectionEl.innerHTML = `
        <div style="display:flex;flex-direction:column;gap:16px;margin-bottom:18px;">
          <h3 style="margin:0">Datos del Participante</h3>
          <div class="notice">
            <strong>Informaci√≥n importante:</strong><br>
            Gracias por participar de esta evaluaci√≥n de <strong>Clima Organizacional</strong>.
            La informaci√≥n suministrada es de car√°cter <strong>confidencial</strong> y es muy importante realizarla de manera <strong>honesta</strong>.
          </div>
        </div>

        <div class="input-grid">
          <div class="input-group">
            <label>Cargo <span style="color:#dc2626">*</span></label>
            <div class="select-wrapper">
              <select id="cargo" name="cargo" required>
                <option value="">Selecciona tu cargo...</option>
                ${CARGOS.map(cargo => `<option value="${cargo}">${cargo}</option>`).join('')}
              </select>
            </div>
          </div>
          <!-- Campo oculto para observaciones -->
          <input type="hidden" id="observaciones_iniciales" name="observaciones_iniciales" value="Observaciones iniciales (campo oculto)" class="hidden-field">
        </div>
      `;
    } else if (sec.type === "sociodemo") {
      sectionEl.innerHTML = `
        <h3>Datos sociodemogr√°ficos (Opcional)</h3>
        <div class="optionalNote">Estos datos son opcionales. Puedes dejarlos sin seleccionar.</div>

        <div class="input-grid">
          <div class="input-group">
            <label>Sexo</label>
            <div class="select-wrapper">
              <select name="sexo">
                <option value="">Selecciona‚Ä¶</option>
                <option>Hombre</option>
                <option>Mujer</option>
                <option>Prefiero no contestar</option>
              </select>
            </div>
          </div>

          <div class="input-group">
            <label>Edad</label>
            <div class="select-wrapper">
              <select name="edad">
                <option value="">Selecciona‚Ä¶</option>
                <option>Menor de 25 a√±os</option>
                <option>Entre 25 ‚Äì 35 a√±os</option>
                <option>Entre 36 ‚Äì 45 a√±os</option>
                <option>Entre 46 ‚Äì 55 a√±os</option>
                <option>56 o m√°s</option>
              </select>
            </div>
          </div>

          <div class="input-group">
            <label>Antig√ºedad en la Compa√±√≠a</label>
            <div class="select-wrapper">
              <select name="antiguedad">
                <option value="">Selecciona‚Ä¶</option>
                <option>2 a√±os o menos</option>
                <option>De 3 a 5 a√±os</option>
                <option>De 6 a 10 a√±os</option>
                <option>De 11 a 15 a√±os</option>
                <option>M√°s de 15 a√±os</option>
              </select>
            </div>
          </div>
        </div>
      `;
    } else if (sec.type === "observaciones") {
      sectionEl.innerHTML = `
        <h3>Observaciones Finales</h3>
        <div class="input-group">
          <label>Observaciones, sugerencias o comentarios finales <span style="color:#dc2626">*</span></label>
          <textarea id="observaciones_finales" name="observaciones_finales" required minlength="10"
            placeholder="Este campo es obligatorio y muy importante para la organizaci√≥n. Escribe con sinceridad."></textarea>
        </div>
      `;
    } else {
      sectionEl.innerHTML = `<h3>${esc(sec.title)}</h3>`;
      sec.questions.forEach((qText) => {
        qCounter++;
        const qName = `${sec.id}_q${qCounter}`;

        const qDiv = document.createElement("div");
        qDiv.className = "q";
        qDiv.dataset.question = "1";
        qDiv.dataset.qname = qName;
        qDiv.dataset.qtext = qText; // üëà guardamos el texto original para enviarlo al webhook

        qDiv.innerHTML = `
          <div class="qtext">
            ${esc(qText)}
            <small>Obligatorio</small>
          </div>
          ${renderScale(qName)}
        `;
        sectionEl.appendChild(qDiv);
      });
    }

    sectionsWrap.appendChild(sectionEl);
  });

  // selection UI
  document.addEventListener("change", (e) => {
    if (e.target && e.target.matches('input[type="radio"]')) {
      const scale = e.target.closest(".scale");
      if (!scale) return;
      $$("label", scale).forEach(l => l.classList.remove("selected"));
      e.target.parentElement.classList.add("selected");

      const q = e.target.closest(".q");
      if (q) q.classList.remove("error");
    }
  });

  const sections = $$(".section");
  let index = 0;

  const bar = $("#bar");
  const prevBtn = $("#prev");
  const nextBtn = $("#next");
  const stepChip = $("#stepChip");

  function updateNav(){
    sections.forEach(s => s.classList.remove("active"));
    sections[index].classList.add("active");
    bar.style.width = (((index+1)/sections.length)*100).toFixed(0) + "%";
    stepChip.textContent = `Secci√≥n ${index+1} de ${sections.length}`;
    prevBtn.disabled = index === 0;
    nextBtn.textContent = (index === sections.length-1) ? "FINALIZAR" : "SIGUIENTE";
    window.scrollTo({top:0, behavior:"smooth"});
  }

  function validateCurrentSection(){
    const current = sections[index];

    // inputs required
    const requiredInputs = $$("input[required], textarea[required], select[required]", current);
    for (const inp of requiredInputs) {
      if (!inp.checkValidity()) {
        inp.focus();
        inp.reportValidity();
        return false;
      }
    }

    // questions required
    const questions = $$("[data-question]", current);
    if (questions.length) {
      let firstMissing = null;
      questions.forEach(q => q.classList.remove("error"));

      for (const q of questions) {
        const name = q.querySelector(".scale")?.dataset.name;
        const checked = name ? document.querySelector(`input[name="${CSS.escape(name)}"]:checked`) : null;
        if (!checked) {
          q.classList.add("error");
          if (!firstMissing) firstMissing = q;
        }
      }

      if (firstMissing) {
        firstMissing.scrollIntoView({behavior:"smooth", block:"center"});
        alert("Debes responder todas las preguntas de esta secci√≥n antes de continuar.");
        return false;
      }
    }

    return true;
  }

  function buildPayload(){
    const form = $("#form");

    // 1) respuestas por name
    const respuestas = {};
    const respuestasDetalladas = [];

    // Recorremos todas las preguntas generadas
    const qBlocks = $$(".q[data-question]");
    for (const qb of qBlocks) {
      const name = qb.querySelector(".scale")?.dataset.name;
      const text = qb.dataset.qtext || "";
      const checked = name ? document.querySelector(`input[name="${CSS.escape(name)}"]:checked`) : null;
      const value = checked ? checked.value : "";

      // mapa simple
      respuestas[name] = value;

      // mapa detallado (√∫til en pabbly/sheets)
      respuestasDetalladas.push({
        id: name,
        pregunta: text,
        valor: value,
        etiqueta: value ? LIKERT[Number(value)-1] : ""
      });
    }

    // 2) datos b√°sicos
    const payload = {
      fecha_envio: new Date().toISOString(),
      organizacion: ORG_NAME,
      participante: {
        cargo: form.cargo?.value?.trim() || "",
        observaciones_iniciales: form.observaciones_iniciales?.value?.trim() || ""
      },
      sociodemograficos: {
        sexo: form.sexo?.value || "",
        edad: form.edad?.value || "",
        antiguedad: form.antiguedad?.value || ""
      },
      observaciones_finales: form.observaciones_finales?.value?.trim() || "",
      respuestas,                 // { name: "1-5" }
      respuestas_detalladas: respuestasDetalladas // [{id,pregunta,valor,etiqueta}]
    };

    return payload;
  }

  async function sendToWebhook(payload){
    // Enviar JSON a Pabbly
    const res = await fetch(WEBHOOK_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });

    if (!res.ok) {
      const txt = await res.text().catch(() => "");
      throw new Error("Webhook respondi√≥ con error: " + res.status + " " + txt);
    }
    return res.text().catch(() => "");
  }

  prevBtn.addEventListener("click", () => {
    clearStatus();
    if (index > 0) {
      index--;
      updateNav();
    }
  });

  nextBtn.addEventListener("click", async () => {
    clearStatus();

    // validate before move forward (except sociodemo optional)
    const currentId = sections[index].dataset.sectionId;
    const isOptionalSection = (currentId === "sociodemo");
    if (!isOptionalSection) {
      if (!validateCurrentSection()) return;
    }

    if (index < sections.length-1) {
      index++;
      updateNav();
      return;
    }

    // ‚úÖ FINALIZAR: VALIDAR √öLTIMA SECCI√ìN (observaciones) y ENVIAR
    if (!validateCurrentSection()) return;

    // bloquear bot√≥n para evitar doble env√≠o
    nextBtn.disabled = true;
    prevBtn.disabled = true;
    setStatus("Enviando informaci√≥n‚Ä¶ por favor espera.");

    try{
      const payload = buildPayload();
      await sendToWebhook(payload);

      alert("‚úÖ Encuesta enviada correctamente. ¬°Gracias por tu participaci√≥n!");
      setStatus("‚úÖ Enviado correctamente.");

      // reset (opcional)
      document.getElementById("form").reset();

      // volver al inicio
      index = 0;
      updateNav();
    }catch(err){
      console.error(err);
      alert("‚ùå No se pudo enviar al SERVIDOR. Revisa tu conexi√≥n e intenta de nuevo.");
      setStatus("‚ùå Error al enviar. Intenta nuevamente.");
    }finally{
      nextBtn.disabled = false;
      prevBtn.disabled = false;
    }
  });

  updateNav();
})();
</script>
</body>

</html>

